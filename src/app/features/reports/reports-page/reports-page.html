<div *ngIf="!canSeeReports()" style="padding:16px; opacity:.8;">
  No tienes permisos para ver reportes.
</div>

<div *ngIf="canSeeReports()" style="padding:16px; display:flex; flex-direction:column; gap:14px;">

  <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
    <h2 style="margin:0;">Reportes</h2>
    <button mat-stroked-button (click)="clearFilters()">Limpiar</button>
  </div>

  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <!-- Día para DAILY CLOSE -->
  <div style="display:flex; flex-direction:column; gap:10px;">
    <mat-divider></mat-divider>

    <mat-form-field appearance="outline" style="min-width:260px;">
      <mat-label>Día (para Daily Close)</mat-label>
      <input matInput [matDatepicker]="dpDayPick" [(ngModel)]="dayPick" (dateChange)="onDayChanged()" />
      <mat-datepicker-toggle matSuffix [for]="dpDayPick"></mat-datepicker-toggle>
      <mat-datepicker #dpDayPick></mat-datepicker>
    </mat-form-field>
  </div>

  <!-- Tarjetas DAILY CLOSE -->
  <div *ngIf="dailyClose as dc" style="display:flex; flex-direction:column; gap:10px;">
    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px;">

      <div style="border:1px solid rgba(0,0,0,.1); border-radius:16px; padding:12px 14px; background:white;">
        <div style="opacity:.7; font-size:12px;">Día</div>
        <div style="font-size:20px; font-weight:900;">
          {{ dc.day || '—' }}
        </div>
      </div>

      <div style="border:1px solid rgba(0,0,0,.1); border-radius:16px; padding:12px 14px; background:white;">
        <div style="opacity:.7; font-size:12px;">Ventas completadas</div>
        <div style="font-size:22px; font-weight:900;">
          {{ dc.salesCompleted || 0 }}
        </div>
      </div>

      <div style="border:1px solid rgba(0,0,0,.1); border-radius:16px; padding:12px 14px; background:white;">
        <div style="opacity:.7; font-size:12px;">Total vendido</div>
        <div style="font-size:22px; font-weight:900;">
          {{ money(dc.totalSold || 0) }}
        </div>
      </div>

      <div
        style="border:1px solid rgba(0,0,0,.1); border-radius:16px; padding:12px 14px; background:white; cursor:pointer;"
        (click)="openItemsModalDaily()"
        title="Ver desglose topProducts"
      >
        <div style="opacity:.7; font-size:12px;">Piezas vendidas (clic para desglose)</div>
        <div style="font-size:22px; font-weight:900;">
          {{ dc.itemsQty || 0 }}
        </div>
      </div>

      <div style="border:1px solid rgba(0,0,0,.1); border-radius:16px; padding:12px 14px; background:white;">
        <div style="opacity:.7; font-size:12px;">Cancelaciones</div>
        <div style="font-size:22px; font-weight:900;">
          {{ dc.cancelsCount || 0 }}
        </div>
      </div>

      

    </div>
  </div>

</div>



<!-- ========================= -->
<!-- MODAL: topProducts        -->
<!-- ========================= -->
<div *ngIf="itemsModalDaily"
  style="position:fixed; inset:0; background:rgba(0,0,0,.35); display:flex; align-items:center; justify-content:center; padding:16px; z-index:99999;"
  (click)="closeDailyItemsModal()"
>
  <div
    style="background:white; width:min(520px, 100%); border-radius:16px; padding:16px; box-shadow:0 8px 30px rgba(0,0,0,.18);"
    (click)="$event.stopPropagation()"
  >
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <h3 style="margin:0;">{{ itemsModalDaily.title }}</h3>
      <button mat-stroked-button (click)="closeDailyItemsModal()">Cerrar</button>
    </div>

    <div style="margin-top:12px; max-height:360px; overflow:auto;">
      <div *ngIf="itemsModalDaily.items.length === 0" style="opacity:.7;">
        No hay desglose para este día.
      </div>

      <div *ngFor="let it of itemsModalDaily.items"
        style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid rgba(0,0,0,.08);"
      >
        <div style="font-weight:700;">{{ it.name }}</div>
        <div style="font-family:ui-monospace; opacity:.85;">{{ it.qty }} pzs</div>
      </div>
    </div>
  </div>
</div>
